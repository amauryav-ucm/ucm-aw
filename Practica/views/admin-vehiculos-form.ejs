<% formTitle = method==="create"?"Nuevo Vehículo":"Modificar Vehículo" %>

<form id="formLogin" method="POST" class="rounded border border-3 p-5 needs-validation" novalidate>
    <fieldset>
        <legend class="text-center fw-bold"><%= formTitle %></legend>
        <div class="py-3">
            <% if (locals.err) { %>
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <h5 class="alert-heading">Ha ocurrido un error</h5>
                <%= locals.err %>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
            </div>
            <% } %>

            <% if (locals.success) { %>
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <h5 class="alert-heading">Enhorabuena</h5>
                La acción se ha completado con éxito
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
                <hr>
                <a class="btn btn-secondary" href="/administracion/vehiculos">Volver</a>
            </div>
            <% } %>

            <% if (method==="update") { %>

            <div class="mb-3">
                <label for="id_vehiculo" class="form-label fw-bold">ID Vehículo</label>
                <input type="text" id="id_vehiculo" class="form-control-plaintext" name="id_vehiculo" value="<%= vehiculo.id_vehiculo %>" required readonly>
            </div>

            <% } %>


            <div class="mb-3">
                <label for="matricula" class="form-label fw-bold">Matrícula</label>
                <input type="text" id="matricula" class="form-control" name="matricula" pattern="[0-9]{4}-[A-Z]{3}"
                    value="<%= method==="update"?vehiculo.matricula:"" %>" required>
                <span class="invalid-feedback">Introduce la matrícula en el formato 1234-AAA</span>
            </div>

            <div class="mb-3">
                <label for="marca" class="form-label fw-bold">Marca</label>
                <input type="text" id="marca" class="form-control" name="marca" value="<%= method==="update"?vehiculo.marca:"" %>" required>
            </div>

            <div class="mb-3">
                <label for="modelo" class="form-label fw-bold">Modelo</label>
                <input type="text" id="modelo" class="form-control" name="modelo" value="<%= method==="update"?vehiculo.modelo:"" %>" required>
            </div>

            <div class="mb-3">
                <label for="anyo_matriculacion" class="form-label fw-bold">Año de matriculación</label>
                <input type="number" id="anyo_matriculacion" class="form-control" min="1901" max="2155" name="anyo_matriculacion"
                    value="<%= method==="update"?vehiculo.anyo_matriculacion:"" %>" required>
                <span class="invalid-feedback">Introduce un año válido</span>
            </div>

            <div class="mb-3">
                <label for="numero_plazas" class="form-label fw-bold">Número de plazas</label>
                <input type="number" id="numero_plazas" class="form-control" min="1" max="10" name="numero_plazas"
                    value="<%= method==="update"?vehiculo.numero_plazas:"" %>" required>
                <span class="invalid-feedback">Introduce número entre 1 y 10</span>
            </div>


            <div class="mb-3">
                <label for="autonomia_km" class="form-label fw-bold">Antonomía Máxima</label>
                <input type="number" id="autonomia_km" class="form-control" min="1" max="10000" name="autonomia_km"
                    value="<%= method==="update"?vehiculo.autonomia_km:"" %>" required>
                <span class="invalid-feedback">Introduce número entre 1 y 10000</span>
            </div>


            <div class="mb-3">
                <label for="autonomia_actual" class="form-label fw-bold">Antonomía Actual</label>
                <input type="number" id="autonomia_actual" class="form-control" min="1" max="10000" name="autonomia_actual"
                    value="<%= method==="update"?vehiculo.autonomia_actual:"" %>" required>
                <span class="invalid-feedback">Introduce número entre 1 y 10000</span>
            </div>

            <div class="mb-3">
                <label for="color" class="form-label fw-bold">Color</label>
                <input type="text" id="color" class="form-control" name="color" value="<%= method==="update"?vehiculo.color:"" %>" required>
            </div>

            <div class="mb-3">
                <label for="imagen" class="form-label fw-bold">Imagen</label>
                <input type="text" id="imagen" class="form-control" name="imagen" value="<%= method==="update"?vehiculo.imagen:"" %>" required>
            </div>

            <div class="mb-3">
                <label for="estado" class="form-label fw-bold">Estado</label>
                <select id="estado" class="form-select" name="estado" required>
                    <% ["disponible", "reservado", "mantenimiento"].forEach(s => { %>
                    <option value=<%= s %> <%= method==="update" && s===vehiculo.estado ? "selected" : "" %>><%=s.charAt(0).toUpperCase() + s.slice(1)%>
                    </option>
                    <% }) %>
                </select>
            </div>

            <div class="mb-3">
                <label for="id_concesionario" class="form-label">Concesionario</label>
                <select id="id_concesionario" class="form-select" name="id_concesionario" required>
                    <option value="">Selecciona un concesionario</option>
                    <% concesionarios.forEach(c => { %>
                    <option value=<%= c.id_concesionario %>
                        <%= method==="update" && parseInt(vehiculo.id_concesionario) === parseInt(c.id_concesionario) ? "selected" : "" %>>
                        <%= c.nombre %></option>
                    <% }) %>
                </select>
                <span class="invalid-feedback">Selecciona un concesionario</span>
            </div>


        </div>

        <div class="pt-4">
            <button class="btn btn-primary flex-fill" type="submit">Confirmar</button>
        </div>
    </fieldset>
</form>