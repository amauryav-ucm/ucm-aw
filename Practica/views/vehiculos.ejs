<h1 class="text-center">Vehículos Disponibles</h1>
<button class="btn btn-primary" data-bs-toggle="offcanvas" data-bs-target="#offcanvasFiltrarVehiculos">Filtrar</button>

<div id="listaVehiculos" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mt-3">

</div>

<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasFiltrarVehiculos" aria-labelledby="offcanvasFiltrarVehiculosTitle">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasFiltrarVehiculosTitle">Filtrar Vehículos</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <form class="m-3 p-3 border rounded" id="filtroVehiculosForm" method="GET">
            <% if (locals.user && locals.user.rol === "admin") { %>
            <fieldset class="border-bottom mb-3 pb-3">
                <legend class="fs-5">Ciudad</legend>
                <% opciones.ciudad.forEach(c => { %>
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="filtroVehiculosConcesionario-<%= c %>" name="ciudad" value="<%= c %>"
                        <%= filtros.ciudad && filtros.ciudad.includes(c.toLowerCase()) ? 'checked' : '' %>>
                    <label class="form-check-label" for="filtroVehiculosColor-<%= c %>"><%= c %></label>
                </div>
                <% }) %>
            </fieldset>
            <fieldset class="border-bottom mb-3 pb-3">
                <legend class="fs-5">Concesionario</legend>
                <% opciones.concesionario.forEach(c => { %>
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="filtroVehiculosConcesionario-<%= c.id_concesionario %>" name="concesionario"
                        value="<%= c.id_concesionario %>" <%= filtros.concesionario && filtros.concesionario.includes(c.id_concesionario) ? 'checked' : '' %>>
                    <label class="form-check-label" for="filtroVehiculosColor-<%= c.id_concesionario %>"><%= c.nombre %></label>
                </div>
                <% }) %>
            </fieldset>
            <% } %>

            <fieldset class="border-bottom mb-3 pb-3">
                <legend class="fs-5">Color</legend>
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="filtroVehiculosColor-all" <%= filtros.color.length===0 ? 'checked' : '' %>>
                    <label class="form-check-label" for="filtroVehiculosColor-all">Todos</label>
                </div>
                <% opciones.color.forEach(c => { %>
                <div class="form-check">
                    <input type="checkbox" class="form-check-input filtroVehiculosColor-option" id="filtroVehiculosColor-<%= c.replace(/\s+/g, '-') %>"
                        name="color" value="<%= c %>" <%= filtros.color && filtros.color.includes(c) ? 'checked' : '' %>>
                    <label class="form-check-label" for="filtroVehiculosColor-<%= c.replace(/\s+/g, '-') %>"><%= myUtils.capitalize(c) %></label>
                </div>
                <% }) %>
            </fieldset>
            <fieldset id="filtrosNumPlazas" class="border-bottom pb-3 mb-3">
                <legend class="fs-5">Número de plazas</legend>
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="filtroVehiculosNumeroPlazas-all"
                        <%= filtros.numero_plazas.length===0 ? 'checked' : '' %>>
                    <label class="form-check-label" for="filtroVehiculosNumeroPlazas-all">Todos</label>
                </div>
                <% opciones.numero_plazas.forEach(p => { %>
                <div class="form-check">
                    <input type="checkbox" class="form-check-input filtroVehiculosNumeroPlazas-option" id="filtroVehiculosNumeroPlazas-<%= p %>"
                        name="numero_plazas" value="<%= p %>" <%= filtros.numero_plazas && filtros.numero_plazas.includes(p) ? 'checked' : '' %>>
                    <label class="form-check-label" for="filtroVehiculosNumeroPlazas-<%= p %>"><%= p %></label>
                </div>
                <% }) %>
            </fieldset>
            <fieldset class="border-bottom pb-3 mb-3">
                <legend class="fs-5">Autonomía mínima</legend>
                <input type="range" class="form-range" min="0" max="1000" step="50"
                    value="<% if (!filtros.autonomia_km) { %>0<% } else { %><%= filtros.autonomia_km %><% } %>" id="filtroAutonomia" name="autonomia_km">
                <output for="filtroAutonomia" id="filtroAutonomiaValor" aria-hidden="true"></output>
            </fieldset>
            <fieldset>
                <div class="g-1 row row-cols-1 row-cols-md-2">
                    <div class="col">
                        <button id="filtroVehiculosConfirm" class="btn btn-primary w-100" type="submit">Confirmar</button>
                    </div>
                    <div class="col">
                        <button class="btn btn-secondary w-100" type="reset" id="filtroVehiculosReset">Limpiar</button>
                    </div>
                </div>
            </fieldset>
        </form>

    </div>
</div>

<script defer src="/js/filtrarVehiculos.js"></script>
<script defer src="/js/vehiculos.js"></script>